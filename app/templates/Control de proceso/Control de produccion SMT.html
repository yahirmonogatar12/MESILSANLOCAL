<!-- TEMPLATE AJAX: Control diario de inspeccion de SMT -->
<!-- SUFIJO ÚNICO: -control-diario-inspeccion-smt -->
<!-- CONTENEDOR: control-diario-inspeccion-smt-unique-container -->

<div id="control-diario-inspeccion-smt-main-container-unique-control-diario-inspeccion-smt" class="control-diario-inspeccion-smt-container">
    <div class="module-header">
        <h2>Control diario de inspección de SMT</h2>
        <p>Fecha: {{ fecha_hoy }}</p>
    </div>
    
    <div class="module-content">
        <div class="inspection-form-section">
            <h3>Registro de Inspección</h3>
            <div class="row">
                <div class="col-md-3">
                    <label>Línea SMT:</label>
                    <select id="linea-control-inspeccion-smt" class="form-control">
                        <option value="">Seleccionar línea</option>
                        <option value="SMT-01">SMT-01</option>
                        <option value="SMT-02">SMT-02</option>
                        <option value="SMT-03">SMT-03</option>
                        <option value="SMT-04">SMT-04</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <label>Modelo:</label>
                    <input type="text" id="modelo-control-inspeccion-smt" class="form-control" placeholder="Buscar modelo">
                </div>
                <div class="col-md-3">
                    <label>Orden de Trabajo:</label>
                    <input type="text" id="wo-control-inspeccion-smt" class="form-control" placeholder="WO-XXXXX">
                </div>
                <div class="col-md-3">
                    <label>Lote:</label>
                    <input type="text" id="lote-control-inspeccion-smt" class="form-control" placeholder="Número de lote">
                </div>
            </div>
            
            <div class="row mt-3">
                <div class="col-md-3">
                    <label>Cantidad Inspeccionada:</label>
                    <input type="number" id="cantidad-inspeccionada" class="form-control" min="0">
                </div>
                <div class="col-md-3">
                    <label>Cantidad Aprobada:</label>
                    <input type="number" id="cantidad-aprobada" class="form-control" min="0">
                </div>
                <div class="col-md-3">
                    <label>Cantidad Rechazada:</label>
                    <input type="number" id="cantidad-rechazada" class="form-control" min="0">
                </div>
                <div class="col-md-3">
                    <label>Inspector:</label>
                    <input type="text" id="inspector-control-smt" class="form-control" value="{{ session.get('usuario', '') }}">
                </div>
            </div>
            
            <div class="defects-section mt-3">
                <h4>Registro de Defectos</h4>
                <div class="row">
                    <div class="col-md-12">
                        <button class="btn btn-sm btn-primary" onclick="window.agregarDefecto()">Agregar Defecto</button>
                    </div>
                </div>
                <div id="defectos-container" class="mt-2">
                    <!-- Defectos dinámicos -->
                </div>
            </div>
            
            <div class="row mt-3">
                <div class="col-md-12">
                    <label>Observaciones:</label>
                    <textarea id="observaciones-control-inspeccion" class="form-control" rows="3"></textarea>
                </div>
            </div>
            
            <div class="row mt-3">
                <div class="col-md-12">
                    <button class="btn btn-success" onclick="window.guardarInspeccion()">Guardar Inspección</button>
                    <button class="btn btn-secondary" onclick="window.limpiarFormularioInspeccion()">Limpiar</button>
                </div>
            </div>
        </div>
        
        <div class="inspections-list-section mt-4">
            <h3>Inspecciones del Día</h3>
            <div class="stats-row mb-3">
                <span class="stat-item">Total: <strong id="total-dia">0</strong></span>
                <span class="stat-item">Aprobados: <strong class="text-success" id="aprobados-dia">0</strong></span>
                <span class="stat-item">Rechazados: <strong class="text-danger" id="rechazados-dia">0</strong></span>
                <span class="stat-item">% Aprobación: <strong class="text-info" id="porcentaje-dia">0%</strong></span>
            </div>
            <table id="tabla-control-diario-inspeccion-smt" class="table table-striped">
                <thead>
                    <tr>
                        <th>Hora</th>
                        <th>Línea</th>
                        <th>Modelo</th>
                        <th>WO</th>
                        <th>Lote</th>
                        <th>Inspeccionado</th>
                        <th>Aprobado</th>
                        <th>Rechazado</th>
                        <th>Defectos</th>
                        <th>Inspector</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Datos dinámicos -->
                </tbody>
            </table>
        </div>
        
        <div class="module-actions">
            <button class="btn btn-info" onclick="window.verResumenDiario()">Ver Resumen</button>
            <button class="btn btn-warning" onclick="window.exportarInspeccionesDia()">Exportar Día</button>
        </div>
    </div>
</div>

<style>
/* Estilos específicos del módulo */
.control-diario-inspeccion-smt-container {
    padding: 20px;
    background-color: #2B2D3E;
    color: #E0E0E0;
    min-height: calc(100vh - 100px);
}

.control-diario-inspeccion-smt-container .module-header {
    background-color: #1E1E2E;
    padding: 15px;
    border-radius: 8px;
    margin-bottom: 20px;
}

.control-diario-inspeccion-smt-container h2 {
    color: #3498db;
    margin: 0;
}

.control-diario-inspeccion-smt-container .module-content {
    background-color: #32323E;
    padding: 20px;
    border-radius: 8px;
}

.control-diario-inspeccion-smt-container .inspection-form-section,
.control-diario-inspeccion-smt-container .inspections-list-section {
    background-color: #2B2D3E;
    padding: 15px;
    border-radius: 5px;
    margin-bottom: 20px;
}

.control-diario-inspeccion-smt-container .defects-section {
    background-color: #1E1E2E;
    padding: 15px;
    border-radius: 5px;
}

.control-diario-inspeccion-smt-container .defect-item {
    background-color: #252531;
    padding: 10px;
    margin: 5px 0;
    border-radius: 4px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.control-diario-inspeccion-smt-container .stats-row {
    background-color: #1E1E2E;
    padding: 10px;
    border-radius: 5px;
    display: flex;
    justify-content: space-around;
}

.control-diario-inspeccion-smt-container .stat-item {
    font-size: 14px;
}

.control-diario-inspeccion-smt-container .form-control {
    background-color: #1E1E2E;
    border: 1px solid #444;
    color: #E0E0E0;
}

.control-diario-inspeccion-smt-container .form-control:focus {
    background-color: #252531;
    border-color: #3498db;
    color: #E0E0E0;
}

.control-diario-inspeccion-smt-container .table {
    background-color: #2B2D3E;
    color: #E0E0E0;
}

.control-diario-inspeccion-smt-container .table thead {
    background-color: #1E1E2E;
}
</style>

<script>
// Auto-inicialización del módulo
(function() {
    console.log('Inicializando Control diario de inspección de SMT AJAX...');
    
    let defectosActuales = [];
    let inspeccionesDelDia = [];
    
    // Función de inicialización global
    window.inicializarControlDiarioInspeccionSMTAjax = function() {
        console.log('Control diario de inspección de SMT AJAX inicializado');
        cargarInspeccionesDelDia();
        configurarCalculosAutomaticos();
    };
    
    // Configurar cálculos automáticos
    function configurarCalculosAutomaticos() {
        const cantInspeccionada = document.getElementById('cantidad-inspeccionada');
        const cantAprobada = document.getElementById('cantidad-aprobada');
        const cantRechazada = document.getElementById('cantidad-rechazada');
        
        cantInspeccionada.addEventListener('input', actualizarCalculos);
        cantAprobada.addEventListener('input', actualizarCalculos);
        cantRechazada.addEventListener('input', actualizarCalculos);
    }
    
    function actualizarCalculos() {
        const inspeccionada = parseInt(document.getElementById('cantidad-inspeccionada').value) || 0;
        const aprobada = parseInt(document.getElementById('cantidad-aprobada').value) || 0;
        const rechazada = parseInt(document.getElementById('cantidad-rechazada').value) || 0;
        
        // Validar que aprobada + rechazada = inspeccionada
        if (aprobada + rechazada !== inspeccionada && inspeccionada > 0) {
            document.getElementById('cantidad-rechazada').value = inspeccionada - aprobada;
        }
    }
    
    function cargarInspeccionesDelDia() {
        // Simular carga de inspecciones
        actualizarEstadisticasDia();
    }
    
    function actualizarEstadisticasDia() {
        // Simular estadísticas
        document.getElementById('total-dia').textContent = '450';
        document.getElementById('aprobados-dia').textContent = '425';
        document.getElementById('rechazados-dia').textContent = '25';
        document.getElementById('porcentaje-dia').textContent = '94.4%';
    }
    
    // Funciones globales
    window.agregarDefecto = function() {
        const defectoId = Date.now();
        const defectoHtml = `
            <div class="defect-item" id="defecto-${defectoId}">
                <select class="form-control form-control-sm" style="width: 40%;">
                    <option value="">Seleccionar defecto</option>
                    <option value="componente_faltante">Componente Faltante</option>
                    <option value="soldadura_fria">Soldadura Fría</option>
                    <option value="puente_soldadura">Puente de Soldadura</option>
                    <option value="componente_desplazado">Componente Desplazado</option>
                    <option value="polaridad_incorrecta">Polaridad Incorrecta</option>
                    <option value="otro">Otro</option>
                </select>
                <input type="number" class="form-control form-control-sm" placeholder="Cantidad" style="width: 20%;" min="1">
                <input type="text" class="form-control form-control-sm" placeholder="Ubicación" style="width: 25%;">
                <button class="btn btn-sm btn-danger" onclick="window.eliminarDefecto(${defectoId})">Eliminar</button>
            </div>
        `;
        
        document.getElementById('defectos-container').insertAdjacentHTML('beforeend', defectoHtml);
        defectosActuales.push(defectoId);
    };
    
    window.eliminarDefecto = function(defectoId) {
        document.getElementById(`defecto-${defectoId}`).remove();
        defectosActuales = defectosActuales.filter(id => id !== defectoId);
    };
    
    window.guardarInspeccion = function() {
        const linea = document.getElementById('linea-control-inspeccion-smt').value;
        const modelo = document.getElementById('modelo-control-inspeccion-smt').value;
        const wo = document.getElementById('wo-control-inspeccion-smt').value;
        
        if (!linea || !modelo || !wo) {
            alert('Por favor complete todos los campos requeridos');
            return;
        }
        
        console.log('Guardando inspección...');
        // Lógica para guardar inspección
        
        // Limpiar formulario después de guardar
        window.limpiarFormularioInspeccion();
        cargarInspeccionesDelDia();
    };
    
    window.limpiarFormularioInspeccion = function() {
        document.getElementById('linea-control-inspeccion-smt').value = '';
        document.getElementById('modelo-control-inspeccion-smt').value = '';
        document.getElementById('wo-control-inspeccion-smt').value = '';
        document.getElementById('lote-control-inspeccion-smt').value = '';
        document.getElementById('cantidad-inspeccionada').value = '';
        document.getElementById('cantidad-aprobada').value = '';
        document.getElementById('cantidad-rechazada').value = '';
        document.getElementById('observaciones-control-inspeccion').value = '';
        document.getElementById('defectos-container').innerHTML = '';
        defectosActuales = [];
    };
    
    window.verResumenDiario = function() {
        console.log('Mostrando resumen diario');
        // Lógica para mostrar resumen
    };
    
    window.exportarInspeccionesDia = function() {
        console.log('Exportando inspecciones del día');
        // Lógica para exportar
    };
    
    // Ejecutar inmediatamente si el DOM está listo
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', window.inicializarControlDiarioInspeccionSMTAjax);
    } else {
        window.inicializarControlDiarioInspeccionSMTAjax();
    }
})();
</script>
