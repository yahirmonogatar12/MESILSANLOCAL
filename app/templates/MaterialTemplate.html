<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ilsan Electronics</title>
    
    <!-- PWA Meta Tags -->
    <meta name="description" content="Sistema de Ejecuci√≥n de Manufactura para Ilsan Electronics">
    <meta name="theme-color" content="#3498db">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="ISEMM MES">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="application-name" content="ISEMM MES">
    <meta name="msapplication-TileColor" content="#32323E">
    <meta name="msapplication-tap-highlight" content="no">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="../static/manifest.json">
    
    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" href="../static/logo.png">
    <link rel="apple-touch-icon" sizes="72x72" href="../static/logo.png">
    <link rel="apple-touch-icon" sizes="152x152" href="../static/logo.png">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="../static/logo.png">
    <link rel="shortcut icon" href="../static/logo.png">
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <!-- Font LG Regular -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/yahirmonogatari/lg-fonts/lg-regular.css">
    <link rel="stylesheet" href="../static/style.css">
    <link rel="stylesheet" href="../static/styleHeader.css">
    <link rel="stylesheet" href="../static/css/responsive-mobile.css">
    
</head>
<body>
    
    <div class="main-wrapper"></div>
    <header class="app-header">
        <div class="header-row">

            <!-- Logo y bienvenida a la izquierda -->
            <div class="container-logo-welcome-hamburguer">
            <div class="logo-welcome-container">    
                <img src="../static/logo.png" alt="Ilsan Electronics Logo" class="logo">
                <div class="welcome-text">
                    <span>Bienvenido,</span> {{ usuario }}
                                </div>
                
            </div>
            <!-- Hamburguesa solo visible en m√≥viles -->
            <div class="conatiner-hamburguer">
                <button class="hamburger-btn" id="menu-toggle">
                <span></span>
                <span></span>
                <span></span>
            </button>
    
                </div>
            </div>
            
                    <!-- Botones de navegaci√≥n -->
            <div class="nav-buttons-container" id="nav-container">
                <button class="nav-button" id="Informaci√≥n Basica">
                    <img src="..\static\icons\info.png" class="icono-boton" alt="Informaci√≥n B√°sica">Informaci√≥n B√°sica
                </button>
                <button class="nav-button" id="Control de material">
                    <img src="..\static\icons\material.png" class="icono-boton" alt="Control de material">Control de material
                </button>
                <button class="nav-button" id="Control de producci√≥n">
                    <img src="..\static\icons\produccion.png" class="icono-boton" alt="Control de producci√≥n">Control de producci√≥n
                </button>
                <button class="nav-button" id="Control de proceso">
                    <img src="..\static\icons\proceso.png" class="icono-boton" alt="Control de proceso">Control de proceso
                </button>
                <button class="nav-button" id="Control de calidad">
                    <img src="..\static\icons\calidad.png" class="icono-boton" alt="Control de calidad">Control de calidad
                </button>
                <button class="nav-button" id="Control de resultados">
                    <img src="..\static\icons\resultados.png" class="icono-boton" alt="Control de resultados">Control de resultados
                </button>
                <button class="nav-button" id="Control de reporte">
                    <img src="..\static\icons\reporte.png" class="icono-boton" alt="Control de reporte">Control de reporte
                </button>
                <button class="nav-button" id="Configuraci√≥n de programa">
                    <img src="..\static\icons\configuracion.png" class="icono-boton" alt="Configuraci√≥n de programa">Configuraci√≥n de programa
                </button>
            </div>
        </div>
    </header>

<div class="block-left col-md-3">
    
</div>

    <!-- Contenedor principal para el sidebar -->
<div class="main-content-container" id="material-container" style="display: none;">
    <div class="sidebar-content" id="sidebar-content">
        <div id="informacion-basica-content">
            <!-- El contenido se cargar√° din√°micamente con JavaScript -->
        </div>
        <div id="control-material-content" style="display: none;">
            <!-- El contenido se cargar√° din√°micamente con JavaScript -->
        </div>
        <div id="control-produccion-content" style="display: none;">
            <!-- El contenido se cargar√° din√°micamente con JavaScript -->
        </div>
        <div id="control-proceso-content" style="display: none;">
            <!-- El contenido se cargar√° din√°micamente con JavaScript -->
        </div>
        <div id="control-calidad-content" style="display: none;">
            <!-- El contenido se cargar√° din√°micamente con JavaScript -->
        </div>
        <div id="control-resultados-content" style="display: none;">
            <!-- El contenido se cargar√° din√°micamente con JavaScript -->
        </div>
        <div id="control-reporte-content" style="display: none;">
            <!-- El contenido se cargar√° din√°micamente con JavaScript -->
        </div>
        <div id="configuracion-programa-content" style="display: none;">
            <!-- El contenido se cargar√° din√°micamente con JavaScript -->
        </div>
    </div>
    
    <!-- Contenedor espec√≠fico para el contenido de Control de Material (LADO DERECHO) -->
    <div class="material-content-area" id="material-content-area" style="display: none;">
        <!-- Contenedor por defecto con informaci√≥n general -->
        <div id="material-info-container" style="display: block;">
            <!-- El contenido se cargar√° din√°micamente con JavaScript -->
        </div>
        
        <div id="control-almacen-container" style="display: none;">
            <!-- El contenido se cargar√° din√°micamente con JavaScript -->
        </div>
        <div id="control-salida-container" style="display: none;">
            <!-- El contenido se cargar√° din√°micamente con JavaScript -->
        </div>
        <div id="control-retorno-container" style="display: none;">
            <h2>Control de material retorno</h2>
            <p>Contenido para Control de material retorno - Por implementar</p>
        </div>
        <div id="recibo-pago-container" style="display: none;">
            <h2>Recibo y pago del material</h2>
            <p>Contenido para Recibo y pago del material - Por implementar</p>
        </div>
        <div id="historial-material-container" style="display: none;">
            <h2>Historial de material</h2>
            <p>Contenido para Historial de material - Por implementar</p>
        </div>
        <div id="estatus-material-container" style="display: none;">
            <h2>Estatus de material</h2>
            <p>Contenido para Estatus de material - Por implementar</p>
        </div>
        <div id="material-sustituto-container" style="display: none;">
            <h2>Material sustituto</h2>
            <p>Contenido para Material sustituto - Por implementar</p>
        </div>
        <div id="consultar-peps-container" style="display: none;">
            <h2>Consultar PEPS</h2>
            <p>Contenido para Consultar PEPS - Por implementar</p>
        </div>
        <div id="longterm-inventory-container" style="display: none;">
            <h2>Control de Long-Term Inventory</h2>
            <p>Contenido para Control de Long-Term Inventory - Por implementar</p>
        </div>
        <div id="registro-material-container" style="display: none;">
            <h2>Registro de material real</h2>
            <p>Contenido para Registro de material real - Por implementar</p>
        </div>
        <div id="historial-inventario-container" style="display: none;">
            <h2>Historial de inventario real</h2>
            <p>Contenido para Historial de inventario real - Por implementar</p>
        </div>
        <div id="ajuste-numero-container" style="display: none;">
            <h2>Ajuste de n√∫mero de parte</h2>
            <p>Contenido para Ajuste de n√∫mero de parte - Por implementar</p>
        </div>
    </div>
    
    <!-- Contenedor espec√≠fico para el contenido de Informaci√≥n B√°sica (LADO DERECHO) -->
    <div class="informacion-basica-content-area" id="informacion-basica-content-area" style="display: none;">
        <!-- Contenedor por defecto con informaci√≥n general -->
        <div id="info-basica-default-container" style="display: block;">
            <h2>Informaci√≥n B√°sica</h2>
            <p>Seleccione una opci√≥n del men√∫ lateral para ver el contenido correspondiente.</p>
        </div>
        
        <!-- Contenedores para cada opci√≥n del sidebar de Informaci√≥n B√°sica -->
        <div id="admin-usuario-info-container" style="display: none;">
            <h2>Administracion de usuario</h2>
            <p>Contenido para Administracion de usuario - Por implementar</p>
        </div>
        
        <div id="admin-menu-info-container" style="display: none;">
            <h2>Administraci√≥n de men√∫</h2>
            <p>Contenido para Administraci√≥n de men√∫ - Por implementar</p>
        </div>
        
        <div id="admin-autoridad-info-container" style="display: none;">
            <h2>Administraci√≥n de autoridad</h2>
            <p>Contenido para Administraci√≥n de autoridad - Por implementar</p>
        </div>
        
        <div id="control-codigo-info-container" style="display: none;">
            <h2>Control de lista de c√≥digo</h2>
            <p>Contenido para Control de lista de c√≥digo - Por implementar</p>
        </div>
        
        <div id="admin-itinerario-info-container" style="display: none;">
            <h2>Administraci√≥n de itinerario</h2>
            <p>Contenido para Administraci√≥n de itinerario - Por implementar</p>
        </div>
        
        <div id="consultar-licencias-info-container" style="display: none;">
            <h2>Consultar licencias</h2>
            <p>Contenido para Consultar licencias - Por implementar</p>
        </div>
        
        <div id="control-departamento-info-container" style="display: none;">
            <h2>Control de departamento</h2>
            <p>Contenido para Control de departamento - Por implementar</p>
        </div>
        
        <div id="control-proceso-info-container" style="display: none;">
            <h2>Control de proceso</h2>
            <p>Contenido para Control de proceso - Por implementar</p>
        </div>
        
        <div id="control-orden-proceso-info-container" style="display: none;">
            <h2>Control de orden de proceso</h2>
            <p>Contenido para Control de orden de proceso - Por implementar</p>
        </div>
        
        <div id="control-orden-proceso2-info-container" style="display: none;">
            <h2>Control de orden de proceso 2</h2>
            <p>Contenido para Control de orden de proceso 2 - Por implementar</p>
        </div>
        
        <div id="control-defecto-info-container" style="display: none;">
            <h2>Control de defecto por proceso</h2>
            <p>Contenido para Control de defecto por proceso - Por implementar</p>
        </div>
        
        <div id="control-interfaces-info-container" style="display: none;">
            <h2>Control de interfaces de m√°quina</h2>
            <p>Contenido para Control de interfaces de m√°quina - Por implementar</p>
        </div>
        
        <div id="control-interlock-info-container" style="display: none;">
            <h2>Control de interlock de m√°quina en l√≠nea</h2>
            <p>Contenido para Control de interlock de m√°quina en l√≠nea - Por implementar</p>
        </div>
        
        <div id="control-material-info-container" style="display: none;">
            <!-- El contenido se cargar√° din√°micamente con JavaScript -->
        </div>
        
        <div id="configuracion-msl-info-container" style="display: none;">
            <h2>Configuraci√≥n de MSL</h2>
            <p>Contenido para Configuraci√≥n de MSL - Por implementar</p>
        </div>
        
        <div id="control-cliente-info-container" style="display: none;">
            <h2>Control de cliente</h2>
            <p>Contenido para Control de cliente - Por implementar</p>
        </div>
        
        <div id="control-proveedor-info-container" style="display: none;">
            <h2>Control de proveedor</h2>
            <p>Contenido para Control de proveedor - Por implementar</p>
        </div>
        
        <div id="control-moneda-info-container" style="display: none;">
            <h2>Control de moneda</h2>
            <p>Contenido para Control de moneda - Por implementar</p>
        </div>
        
        <div id="info-empresa-info-container" style="display: none;">
            <h2>Informaci√≥n de empresa</h2>
            <p>Contenido para Informaci√≥n de empresa - Por implementar</p>
        </div>
        
        <!-- Contenedores adicionales para funciones del sidebar -->
        <div id="control-modelos-info-container" style="display: none;">
            <h2>Control de modelos</h2>
            <p>Contenido para Control de modelos - Por implementar</p>
        </div>
        
        <div id="control-bom-info-container" style="display: none;">
            <h2>Control de BOM</h2>
            <p>Contenido para Control de BOM - Por implementar</p>
        </div>
        
        <div id="control-bom-smt-info-container" style="display: none;">
            <h2>Control de BOM de SMT</h2>
            <p>Contenido para Control de BOM de SMT - Por implementar</p>
        </div>
        
        <div id="control-maquina-inf-info-container" style="display: none;">
            <h2>Control de m√°quina</h2>
            <p>Contenido para Control de m√°quina - Por implementar</p>
        </div>
        
        <div id="control-maquina-info-container" style="display: none;">
            <h2>Control de defecto por proceso (m√°quina)</h2>
            <p>Contenido para Control de defecto por proceso (m√°quina) - Por implementar</p>
        </div>
        
        <div id="control-maquina-linea-info-container" style="display: none;">
            <h2>Control de m√°quina en l√≠nea</h2>
            <p>Contenido para Control de m√°quina en l√≠nea - Por implementar</p>
        </div>
    </div>
</div>

    <!-- Agrega este overlay justo despu√©s del header -->
    <div class="mobile-nav-overlay" id="mobile-nav-overlay"></div>

    <!-- Bootstrap JS Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Dropdown Fix for Desktop -->
    <script src="../static/js/dropdown-fix.js"></script>
    
    <!-- Mobile Enhancements -->
    <script src="../static/js/mobile-enhancements.js"></script>
    
    <!-- Mobile Lists Hamburger -->
    <script src="../static/js/mobile-lists-hamburger.js"></script>
    
    <!-- PWA Service Worker Registration -->
    <script>
        // ============================================= 
        // PWA SERVICE WORKER REGISTRATION
        // ============================================= 
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('../static/sw.js')
                    .then(function(registration) {
                        console.log('‚úÖ Service Worker registrado exitosamente:', registration.scope);
                        
                        // Verificar actualizaciones
                        registration.addEventListener('updatefound', function() {
                            const newWorker = registration.installing;
                            console.log('üîÑ Nueva versi√≥n del Service Worker encontrada');
                            
                            newWorker.addEventListener('statechange', function() {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    // Nueva versi√≥n disponible
                                    if (confirm('Nueva versi√≥n disponible. ¬øDesea actualizar?')) {
                                        newWorker.postMessage({ type: 'SKIP_WAITING' });
                                        window.location.reload();
                                    }
                                }
                            });
                        });
                        
                    })
                    .catch(function(error) {
                        console.log('‚ùå Error al registrar Service Worker:', error);
                    });
                
                // Manejar mensajes del Service Worker
                navigator.serviceWorker.addEventListener('message', function(event) {
                    const { type, data } = event.data;
                    
                    switch (type) {
                        case 'INSTALL_AVAILABLE':
                            showInstallPrompt();
                            break;
                        case 'APP_INSTALLED':
                            console.log('üéâ App instalada exitosamente');
                            break;
                    }
                });
            });
        }
        
        // ============================================= 
        // PWA INSTALL PROMPT
        // ============================================= 
        let deferredPrompt;
        let installButton;
        
        window.addEventListener('beforeinstallprompt', function(e) {
            console.log('üì± PWA install prompt disponible');
            e.preventDefault();
            deferredPrompt = e;
            showInstallButton();
        });
        
        function showInstallButton() {
            // Crear bot√≥n de instalaci√≥n si no existe
            if (!installButton && window.innerWidth <= 768) {
                installButton = document.createElement('button');
                installButton.textContent = 'üì± Instalar App';
                installButton.className = 'btn btn-primary install-btn';
                installButton.style.cssText = `
                    position: fixed;
                    bottom: 20px;
                    right: 20px;
                    z-index: 1000;
                    border-radius: 25px;
                    padding: 10px 15px;
                    font-size: 14px;
                    background: linear-gradient(45deg, var(--accent-color), #2980b9);
                    border: none;
                    color: white;
                    box-shadow: 0 4px 15px rgba(52, 152, 219, 0.4);
                    animation: pulse 2s infinite;
                `;
                
                // A√±adir animaci√≥n CSS
                const style = document.createElement('style');
                style.textContent = `
                    @keyframes pulse {
                        0% { transform: scale(1); }
                        50% { transform: scale(1.05); }
                        100% { transform: scale(1); }
                    }
                    .install-btn:hover {
                        transform: scale(1.1);
                        box-shadow: 0 6px 20px rgba(52, 152, 219, 0.6);
                    }
                `;
                document.head.appendChild(style);
                
                installButton.addEventListener('click', function() {
                    if (deferredPrompt) {
                        deferredPrompt.prompt();
                        deferredPrompt.userChoice.then(function(result) {
                            if (result.outcome === 'accepted') {
                                console.log('üéâ Usuario acept√≥ instalar la PWA');
                            } else {
                                console.log('‚ùå Usuario rechaz√≥ instalar la PWA');
                            }
                            deferredPrompt = null;
                            hideInstallButton();
                        });
                    }
                });
                
                document.body.appendChild(installButton);
            }
        }
        
        function hideInstallButton() {
            if (installButton) {
                installButton.style.display = 'none';
                setTimeout(() => {
                    if (installButton && installButton.parentNode) {
                        installButton.parentNode.removeChild(installButton);
                    }
                    installButton = null;
                }, 300);
            }
        }
        
        function showInstallPrompt() {
            showInstallButton();
        }
        
        // Ocultar bot√≥n de instalaci√≥n cuando la app ya est√° instalada
        window.addEventListener('appinstalled', function() {
            console.log('üéâ PWA instalada exitosamente');
            hideInstallButton();
            
            // Mostrar mensaje de bienvenida
            if (window.innerWidth <= 768) {
                setTimeout(() => {
                    alert('¬°App instalada exitosamente! Ahora puedes acceder desde tu pantalla de inicio.');
                }, 1000);
            }
        });
        
        // ============================================= 
        // PWA UTILITIES
        // ============================================= 
        
        // Detectar si la app est√° ejecut√°ndose como PWA
        function isPWA() {
            return window.matchMedia && window.matchMedia('(display-mode: standalone)').matches;
        }
        
        // Aplicar estilos espec√≠ficos para PWA
        if (isPWA()) {
            document.body.classList.add('pwa-mode');
            console.log('üì± Ejecut√°ndose como PWA');
            
            // A√±adir estilos espec√≠ficos para PWA
            const pwaStyle = document.createElement('style');
            pwaStyle.textContent = `
                .pwa-mode .app-header {
                    padding-top: env(safe-area-inset-top, 0);
                }
                .pwa-mode .main-content-container {
                    padding-bottom: env(safe-area-inset-bottom, 0);
                }
            `;
            document.head.appendChild(pwaStyle);
        }
        
        // Funci√≥n para verificar conectividad
        function updateOnlineStatus() {
            const status = navigator.onLine ? 'online' : 'offline';
            document.body.classList.toggle('offline', !navigator.onLine);
            
            if (!navigator.onLine) {
                console.log('üì∂ Modo offline activado');
                // Mostrar indicador de offline
                showOfflineIndicator();
            } else {
                console.log('üì∂ Conexi√≥n restaurada');
                hideOfflineIndicator();
            }
        }
        
        function showOfflineIndicator() {
            let indicator = document.getElementById('offline-indicator');
            if (!indicator) {
                indicator = document.createElement('div');
                indicator.id = 'offline-indicator';
                indicator.textContent = 'üì∂ Sin conexi√≥n - Modo offline';
                indicator.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    right: 0;
                    background-color: #e74c3c;
                    color: white;
                    text-align: center;
                    padding: 8px;
                    z-index: 2000;
                    font-size: 14px;
                `;
                document.body.appendChild(indicator);
            }
        }
        
        function hideOfflineIndicator() {
            const indicator = document.getElementById('offline-indicator');
            if (indicator) {
                indicator.remove();
            }
        }
        
        // Escuchar cambios de conectividad
        window.addEventListener('online', updateOnlineStatus);
        window.addEventListener('offline', updateOnlineStatus);
        
        // Verificar estado inicial
        updateOnlineStatus();
        
        console.log('üöÄ PWA functionality initialized');
    </script>
    <script>
        // ============================================= 
        // MOBILE NAVIGATION ENHANCED
        // ============================================= 
        document.addEventListener('DOMContentLoaded', function() {
            const menuToggle = document.getElementById('menu-toggle');
            const navContainer = document.getElementById('nav-container');
            const overlay = document.getElementById('mobile-nav-overlay');
            
            // Verificar si estamos en dispositivo m√≥vil
            function isMobile() {
                return window.innerWidth <= 768;
            }
            
            // Funci√≥n para cerrar men√∫
            function closeMenu() {
                if (navContainer) navContainer.classList.remove('active');
                if (overlay) overlay.classList.remove('active');
                if (menuToggle) menuToggle.classList.remove('active');
                document.body.classList.remove('menu-open');
            }
            
            // Funci√≥n para abrir men√∫
            function openMenu() {
                if (navContainer) navContainer.classList.add('active');
                if (overlay) overlay.classList.add('active');
                if (menuToggle) menuToggle.classList.add('active');
                document.body.classList.add('menu-open');
            }
            
            // Toggle del men√∫ hamburguesa
            if (menuToggle && navContainer && overlay) {
                menuToggle.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    if (navContainer.classList.contains('active')) {
                        closeMenu();
                    } else {
                        openMenu();
                    }
                });
                
                // Cerrar men√∫ al hacer click en overlay
                overlay.addEventListener('click', function() {
                    closeMenu();
                });
                
                // Cerrar men√∫ al hacer click en un bot√≥n de navegaci√≥n (solo en m√≥vil)
                const navButtons = navContainer.querySelectorAll('.nav-button');
                navButtons.forEach(button => {
                    button.addEventListener('click', function() {
                        const buttonText = this.textContent.trim();
                        console.log(`üì± Click en bot√≥n m√≥vil: ${buttonText}`);
                        
                        if (isMobile()) {
                            // Mapeo de botones a funciones de carga de contenido
                            const buttonActions = {
                                'Informaci√≥n B√°sica': () => {
                                    window.mostrarInformacionBasica();
                                    setTimeout(() => {
                                        cargarContenidoDinamico('informacion-basica-content', '/listas/informacion_basica');
                                    }, 100);
                                },
                                'Control de material': () => {
                                    window.mostrarControlMaterial();
                                    setTimeout(() => {
                                        cargarContenidoDinamico('control-material-content', '/listas/control_material');
                                    }, 100);
                                },
                                'Control de producci√≥n': () => {
                                    window.mostrarControlProduccion();
                                    setTimeout(() => {
                                        cargarContenidoDinamico('control-produccion-content', '/listas/control_produccion');
                                    }, 100);
                                },
                                'Control de proceso': () => {
                                    window.mostrarControlProceso();
                                    setTimeout(() => {
                                        cargarContenidoDinamico('control-proceso-content', '/listas/control_proceso');
                                    }, 100);
                                },
                                'Control de calidad': () => {
                                    window.mostrarControlCalidad();
                                    setTimeout(() => {
                                        cargarContenidoDinamico('control-calidad-content', '/listas/control_calidad');
                                    }, 100);
                                },
                                'Control de resultados': () => {
                                    window.mostrarControlResultados();
                                    setTimeout(() => {
                                        cargarContenidoDinamico('control-resultados-content', '/listas/control_resultados');
                                    }, 100);
                                },
                                'Control de reporte': () => {
                                    window.mostrarControlReporte();
                                    setTimeout(() => {
                                        cargarContenidoDinamico('control-reporte-content', '/listas/control_reporte');
                                    }, 100);
                                },
                                'Configuraci√≥n de programa': () => {
                                    window.mostrarConfiguracionPrograma();
                                    setTimeout(() => {
                                        cargarContenidoDinamico('configuracion-programa-content', '/listas/configuracion_programa');
                                    }, 100);
                                }
                            };
                            
                            // Ejecutar la acci√≥n correspondiente
                            if (buttonActions[buttonText]) {
                                buttonActions[buttonText]();
                            } else {
                                console.warn(`‚ö†Ô∏è No se encontr√≥ acci√≥n para: ${buttonText}`);
                            }
                            
                            setTimeout(closeMenu, 300); // Peque√±o delay para mejor UX
                        }
                    });
                });
                
                // Cerrar men√∫ con tecla Escape
                document.addEventListener('keydown', function(e) {
                    if (e.key === 'Escape' && navContainer.classList.contains('active')) {
                        closeMenu();
                    }
                });
                
                // Cerrar men√∫ al cambiar orientaci√≥n
                window.addEventListener('orientationchange', function() {
                    setTimeout(closeMenu, 100);
                });
                
                // Cerrar men√∫ al redimensionar ventana
                window.addEventListener('resize', function() {
                    if (!isMobile()) {
                        closeMenu();
                    }
                });
            }
            
            // ============================================= 
            // TOUCH GESTURES PARA M√ìVIL
            // ============================================= 
            let touchStartX = 0;
            let touchStartY = 0;
            let touchEndX = 0;
            let touchEndY = 0;
            
            // Detectar swipe gestures
            document.addEventListener('touchstart', function(e) {
                touchStartX = e.changedTouches[0].screenX;
                touchStartY = e.changedTouches[0].screenY;
            }, { passive: true });
            
            document.addEventListener('touchend', function(e) {
                touchEndX = e.changedTouches[0].screenX;
                touchEndY = e.changedTouches[0].screenY;
                handleSwipeGesture();
            }, { passive: true });
            
            function handleSwipeGesture() {
                const swipeThreshold = 50;
                const swipeDistance = touchEndX - touchStartX;
                const verticalDistance = Math.abs(touchEndY - touchStartY);
                
                // Solo procesar swipe horizontal si el vertical es m√≠nimo
                if (verticalDistance < 100 && Math.abs(swipeDistance) > swipeThreshold) {
                    if (swipeDistance > 0 && touchStartX < 50) {
                        // Swipe derecha desde el borde izquierdo - abrir men√∫
                        if (isMobile() && !navContainer.classList.contains('active')) {
                            openMenu();
                        }
                    } else if (swipeDistance < 0 && navContainer.classList.contains('active')) {
                        // Swipe izquierda - cerrar men√∫
                        closeMenu();
                    }
                }
            }
            
            // ============================================= 
            // OPTIMIZACIONES DE RENDIMIENTO M√ìVIL
            // ============================================= 
            
            // Throttle para eventos de scroll
            function throttle(func, wait) {
                let timeout;
                return function executedFunction(...args) {
                    const later = () => {
                        clearTimeout(timeout);
                        func(...args);
                    };
                    clearTimeout(timeout);
                    timeout = setTimeout(later, wait);
                };
            }
            
            // Optimizar scroll en m√≥viles
            if (isMobile()) {
                const scrollableElements = document.querySelectorAll('.sidebar-content, .material-content-area, .informacion-basica-content-area');
                scrollableElements.forEach(element => {
                    element.style.webkitOverflowScrolling = 'touch';
                    element.style.overflowScrolling = 'touch';
                    element.classList.add('scrollable');
                });
            }
            
            // Prevenir zoom en inputs (iOS)
            if (/iPad|iPhone|iPod/.test(navigator.userAgent)) {
                const inputs = document.querySelectorAll('input, select, textarea');
                inputs.forEach(input => {
                    if (input.style.fontSize < '16px') {
                        input.style.fontSize = '16px';
                    }
                });
            }
            
            // ============================================= 
            // VIEWPORT HEIGHT FIX PARA M√ìVILES
            // ============================================= 
            function setViewportHeight() {
                const vh = window.innerHeight * 0.01;
                document.documentElement.style.setProperty('--vh', vh + 'px');
            }
            
            setViewportHeight();
            window.addEventListener('resize', throttle(setViewportHeight, 250));
            window.addEventListener('orientationchange', function() {
                setTimeout(setViewportHeight, 500);
            });
            
            console.log('üöÄ Mobile enhancements initialized');
        });    
    </script>

    <script>    
        // Mostrar/ocultar el contenedor de material seg√∫n el bot√≥n
        document.addEventListener('DOMContentLoaded', function() {
            const materialContainer = document.getElementById('material-container');
            const informacionBasicaContent = document.getElementById('informacion-basica-content');
            const controlMaterialContent = document.getElementById('control-material-content');
            const controlProduccionContent = document.getElementById('control-produccion-content');
            const controlProcesoContent = document.getElementById('control-proceso-content');
            const controlCalidadContent = document.getElementById('control-calidad-content');
            const controlResultadosContent = document.getElementById('control-resultados-content');
            const controlReporteContent = document.getElementById('control-reporte-content');
            const configuracionProgramaContent = document.getElementById('configuracion-programa-content');
            const materialContentArea = document.getElementById('material-content-area');
            const informacionBasicaContentArea = document.getElementById('informacion-basica-content-area');
            const materialInfoContainer = document.getElementById('material-info-container');
            const controlAlmacenContainer = document.getElementById('control-almacen-container');
            const controlSalidaContainer = document.getElementById('control-salida-container');
            const controlRetornoContainer = document.getElementById('control-retorno-container');
            const reciboPagoContainer = document.getElementById('recibo-pago-container');
            const historialMaterialContainer = document.getElementById('historial-material-container');
            const estatusMaterialContainer = document.getElementById('estatus-material-container');
            const materialSustitutoContainer = document.getElementById('material-sustituto-container');
            const consultarPepsContainer = document.getElementById('consultar-peps-container');
            const longtermInventoryContainer = document.getElementById('longterm-inventory-container');
            const registroMaterialContainer = document.getElementById('registro-material-container');
            const historialInventarioContainer = document.getElementById('historial-inventario-container');
            const ajusteNumeroContainer = document.getElementById('ajuste-numero-container');
            const navButtons = document.querySelectorAll('.nav-button');
            
            // Funci√≥n para ocultar todo el contenido
            function hideAllContent() {
                informacionBasicaContent.style.display = 'none';
                controlMaterialContent.style.display = 'none';
                controlProduccionContent.style.display = 'none';
                controlProcesoContent.style.display = 'none';
                controlCalidadContent.style.display = 'none';
                controlResultadosContent.style.display = 'none';
                if (controlReporteContent) controlReporteContent.style.display = 'none';
                configuracionProgramaContent.style.display = 'none';
                
                // FORZAR ocultar completamente las √°reas de contenido
                materialContentArea.style.display = 'none';
                informacionBasicaContentArea.style.display = 'none';
                hideAllMaterialContainers();
                hideAllInformacionBasicaContainers();
            }
            
            // Funci√≥n para resetear completamente la pesta√±a de Informaci√≥n B√°sica
            function resetInformacionBasica() {
                console.log('Reseteando Informaci√≥n B√°sica (sin AJAX)');
                
                // Llamar a la funci√≥n global de reseteo si existe
                if (typeof window.resetInfoBasicaToDefault === 'function') {
                    window.resetInfoBasicaToDefault();
                } else {
                    console.log('Funci√≥n resetInfoBasicaToDefault no disponible a√∫n');
                }
                
                // Asegurar que todos los sidebar-links funcionen
                const sidebarLinks = informacionBasicaContent.querySelectorAll('.sidebar-link');
                sidebarLinks.forEach(link => {
                    link.style.pointerEvents = 'auto';
                    link.style.cursor = 'pointer';
                });
                
                console.log('Sidebar links habilitados:', sidebarLinks.length);
            }
            
            // Funci√≥n para ocultar todos los contenedores de material
            function hideAllMaterialContainers() {
                materialInfoContainer.style.display = 'none';
                controlAlmacenContainer.style.display = 'none';
                controlSalidaContainer.style.display = 'none';
                controlRetornoContainer.style.display = 'none';
                reciboPagoContainer.style.display = 'none';
                historialMaterialContainer.style.display = 'none';
                estatusMaterialContainer.style.display = 'none';
                materialSustitutoContainer.style.display = 'none';
                consultarPepsContainer.style.display = 'none';
                longtermInventoryContainer.style.display = 'none';
                registroMaterialContainer.style.display = 'none';
                historialInventarioContainer.style.display = 'none';
                ajusteNumeroContainer.style.display = 'none';
            }
            
            function hideAllInformacionBasicaContainers() {
                const containers = [
                    'info-basica-default-container',
                    'admin-usuario-info-container', 
                    'admin-menu-info-container',
                    'admin-autoridad-info-container',
                    'control-codigo-info-container',
                    'admin-itinerario-info-container',
                    'consultar-licencias-info-container',
                    'control-departamento-info-container',
                    'control-proceso-info-container',
                    'control-orden-proceso-info-container',
                    'control-orden-proceso2-info-container',
                    'control-defecto-info-container',
                    'control-interfaces-info-container',
                    'control-interlock-info-container',
                    'control-material-info-container',
                    'configuracion-msl-info-container',
                    'control-cliente-info-container',
                    'control-proveedor-info-container',
                    'control-moneda-info-container',
                    'info-empresa-info-container',
                    // Contenedores adicionales para sidebar
                    'control-modelos-info-container',
                    'control-bom-info-container',
                    'control-bom-smt-info-container',
                    'control-maquina-inf-info-container',
                    'control-maquina-info-container',
                    'control-maquina-linea-info-container'
                ];
                
                containers.forEach(containerId => {
                    const container = document.getElementById(containerId);
                    if (container) {
                        container.style.display = 'none';
                    }
                });
            }
            
            // Hacer la funci√≥n disponible globalmente
            window.hideAllInformacionBasicaContainers = hideAllInformacionBasicaContainers;
            
            // Funciones globales para mostrar cada contenedor de Informaci√≥n B√°sica
            window.mostrarAdminUsuarioInfo = function() {
                console.log('Mostrando Administraci√≥n de usuario');
                hideAllInformacionBasicaContainers();
                const container = document.getElementById('admin-usuario-info-container');
                if (container) {
                    container.style.display = 'block';
                }
            };
            
            window.mostrarAdminMenuInfo = function() {
                console.log('Mostrando Administraci√≥n de men√∫');
                hideAllInformacionBasicaContainers();
                const container = document.getElementById('admin-menu-info-container');
                if (container) {
                    container.style.display = 'block';
                }
            };
            
            window.mostrarAdminAutoridadInfo = function() {
                console.log('Mostrando Administraci√≥n de autoridad');
                hideAllInformacionBasicaContainers();
                const container = document.getElementById('admin-autoridad-info-container');
                if (container) {
                    container.style.display = 'block';
                }
            };
            
            window.mostrarControlCodigoInfo = function() {
                console.log('Mostrando Control de lista de c√≥digo');
                hideAllInformacionBasicaContainers();
                const container = document.getElementById('control-codigo-info-container');
                if (container) {
                    container.style.display = 'block';
                }
            };
            
            window.mostrarAdminItinerarioInfo = function() {
                console.log('Mostrando Administraci√≥n de itinerario');
                hideAllInformacionBasicaContainers();
                const container = document.getElementById('admin-itinerario-info-container');
                if (container) {
                    container.style.display = 'block';
                }
            };
            
            window.mostrarConsultarLicenciasInfo = function() {
                console.log('Mostrando Consultar licencias');
                hideAllInformacionBasicaContainers();
                const container = document.getElementById('consultar-licencias-info-container');
                if (container) {
                    container.style.display = 'block';
                }
            };
            
            window.mostrarControlDepartamentoInfo = function() {
                console.log('Mostrando Control de departamento');
                hideAllInformacionBasicaContainers();
                const container = document.getElementById('control-departamento-info-container');
                if (container) {
                    container.style.display = 'block';
                }
            };
            
            window.mostrarControlProcesoInfo = function() {
                console.log('Mostrando Control de proceso');
                hideAllInformacionBasicaContainers();
                const container = document.getElementById('control-proceso-info-container');
                if (container) {
                    container.style.display = 'block';
                }
            };
            
            window.mostrarControlOrdenProcesoInfo = function() {
                console.log('Mostrando Control de orden de proceso');
                hideAllInformacionBasicaContainers();
                const container = document.getElementById('control-orden-proceso-info-container');
                if (container) {
                    container.style.display = 'block';
                }
            };
            
            window.mostrarControlOrdenProceso2Info = function() {
                console.log('Mostrando Control de orden de proceso 2');
                hideAllInformacionBasicaContainers();
                const container = document.getElementById('control-orden-proceso2-info-container');
                if (container) {
                    container.style.display = 'block';
                }
            };
            
            window.mostrarControlDefectoInfo = function() {
                console.log('Mostrando Control de defecto por proceso');
                hideAllInformacionBasicaContainers();
                const container = document.getElementById('control-defecto-info-container');
                if (container) {
                    container.style.display = 'block';
                }
            };
            
            window.mostrarControlInterfacesInfo = function() {
                console.log('Mostrando Control de interfaces de m√°quina');
                hideAllInformacionBasicaContainers();
                const container = document.getElementById('control-interfaces-info-container');
                if (container) {
                    container.style.display = 'block';
                }
            };
            
            window.mostrarControlInterlockInfo = function() {
                console.log('Mostrando Control de interlock de m√°quina en l√≠nea');
                hideAllInformacionBasicaContainers();
                const container = document.getElementById('control-interlock-info-container');
                if (container) {
                    container.style.display = 'block';
                }
            };
            
            window.mostrarConfiguracionMSLInfo = function() {
                console.log('Mostrando Configuraci√≥n de MSL');
                hideAllInformacionBasicaContainers();
                const container = document.getElementById('configuracion-msl-info-container');
                if (container) {
                    container.style.display = 'block';
                }
            };
            
            window.mostrarControlClienteInfo = function() {
                console.log('Mostrando Control de cliente');
                hideAllInformacionBasicaContainers();
                const container = document.getElementById('control-cliente-info-container');
                if (container) {
                    container.style.display = 'block';
                }
            };
            
            window.mostrarControlProveedorInfo = function() {
                console.log('Mostrando Control de proveedor');
                hideAllInformacionBasicaContainers();
                const container = document.getElementById('control-proveedor-info-container');
                if (container) {
                    container.style.display = 'block';
                }
            };
            
            // Funciones adicionales para el sidebar de Informaci√≥n B√°sica
            window.mostrarControlModelosInfo = function() {
                console.log('Mostrando Control de modelos');
                hideAllInformacionBasicaContainers();
                const container = document.getElementById('control-modelos-info-container');
                if (container) {
                    container.style.display = 'block';
                }
            };
            
            window.mostrarControlBOMInfo = function() {
                console.log('Mostrando Control de BOM');
                hideAllInformacionBasicaContainers();
                const container = document.getElementById('control-bom-info-container');
                if (container) {
                    container.style.display = 'block';
                }
            };
            
            window.mostrarControlBOMSMTInfo = function() {
                console.log('Mostrando Control de BOM de SMT');
                hideAllInformacionBasicaContainers();
                const container = document.getElementById('control-bom-smt-info-container');
                if (container) {
                    container.style.display = 'block';
                }
            };
            
            window.Controlmaquinainf = function() {
                console.log('Mostrando Control de m√°quina');
                hideAllInformacionBasicaContainers();
                const container = document.getElementById('control-maquina-inf-info-container');
                if (container) {
                    container.style.display = 'block';
                }
            };
            
            window.mostrarControlMaquinaInfo = function() {
                console.log('Mostrando Control de defecto por proceso (m√°quina)');
                hideAllInformacionBasicaContainers();
                const container = document.getElementById('control-maquina-info-container');
                if (container) {
                    container.style.display = 'block';
                }
            };
            
            window.mostrarControlMaquinaLineaInfo = function() {
                console.log('Mostrando Control de m√°quina en l√≠nea');
                hideAllInformacionBasicaContainers();
                const container = document.getElementById('control-maquina-linea-info-container');
                if (container) {
                    container.style.display = 'block';
                }
            };
            
            // Funci√≥n para mostrar el contenido por defecto de material
            window.mostrarInfoMaterial = function() {
                hideAllMaterialContainers();
                materialContentArea.style.display = 'block';
                materialInfoContainer.style.display = 'block';
                
                // Cargar contenido din√°micamente
                cargarContenidoDinamico('material-info-container', '/material/info')
                    .catch(error => console.error('Error cargando info material:', error));
            };
            
            // Funci√≥n global para mostrar el contenido de almac√©n
            window.mostrarControlAlmacen = function() {
                console.log('üè™ === INICIANDO mostrarControlAlmacen ===');
                hideAllMaterialContainers();
                materialContentArea.style.display = 'block';
                controlAlmacenContainer.style.display = 'block';
                
                // Cargar contenido din√°micamente con callback de inicializaci√≥n
                cargarContenidoDinamico('control-almacen-container', '/material/control_almacen', () => {
                    console.log('üîÑ Inicializando funciones de control de almac√©n...');
                    
                    // Usar la nueva funci√≥n global del m√≥dulo
                    if (typeof window.inicializarControlAlmacenModule === 'function') {
                        console.log('‚úÖ Ejecutando inicializarControlAlmacenModule...');
                        window.inicializarControlAlmacenModule();
                    } else {
                        console.warn('‚ö†Ô∏è inicializarControlAlmacenModule no disponible, intentando m√©todos individuales');
                        
                        // Fallback a la funci√≥n anterior
                        if (typeof window.inicializarControlAlmacen === 'function') {
                            console.log('‚úÖ Ejecutando inicializarControlAlmacen...');
                            window.inicializarControlAlmacen();
                        } else {
                            console.warn('‚ö†Ô∏è inicializarControlAlmacen no disponible, usando m√©todos individuales');
                            // Fallback a m√©todos individuales
                            if (typeof cargarCodigosMaterial === 'function') {
                                console.log('‚úÖ Ejecutando cargarCodigosMaterial...');
                                cargarCodigosMaterial();
                            } else {
                                console.warn('‚ö†Ô∏è cargarCodigosMaterial no disponible');
                            }
                            if (typeof cargarClienteSeleccionado === 'function') {
                                console.log('‚úÖ Ejecutando cargarClienteSeleccionado...');
                                cargarClienteSeleccionado();
                            } else {
                                console.warn('‚ö†Ô∏è cargarClienteSeleccionado no disponible');
                            }
                            if (typeof cargarSiguienteSecuencial === 'function') {
                                console.log('‚úÖ Ejecutando cargarSiguienteSecuencial...');
                                cargarSiguienteSecuencial();
                            } else {
                                console.warn('‚ö†Ô∏è cargarSiguienteSecuencial no disponible');
                            }
                        }
                    }
                    console.log('ÔøΩ Inicializaci√≥n de control de almac√©n completada');
                })
                .catch(error => {
                    console.error('Error cargando control de almac√©n:', error);
                    // Fallback: ejecutar inicializaci√≥n sin contenido din√°mico
                    setTimeout(() => {
                        if (typeof window.inicializarControlAlmacenModule === 'function') {
                            window.inicializarControlAlmacenModule();
                        }
                    }, 200);
                });
                
                console.log('üè™ === FIN mostrarControlAlmacen ===');
            };
            
            // Funciones para mostrar otros contenidos
            window.mostrarControlSalida = function() {
                console.log('üöõ === INICIANDO mostrarControlSalida ===');
                hideAllMaterialContainers();
                materialContentArea.style.display = 'block';
                controlSalidaContainer.style.display = 'block';
                
                // Cargar contenido din√°micamente con callback de inicializaci√≥n
                cargarContenidoDinamico('control-salida-container', '/material/control_salida', () => {
                    console.log('üîÑ Inicializando funciones de control de salida...');
                    
                    // Usar la nueva funci√≥n global del m√≥dulo
                    if (typeof window.inicializarControlSalidaModule === 'function') {
                        console.log('‚úÖ Ejecutando inicializarControlSalidaModule...');
                        window.inicializarControlSalidaModule();
                    } else {
                        console.warn('‚ö†Ô∏è inicializarControlSalidaModule no disponible');
                    }
                    console.log('‚úÖ Inicializaci√≥n de control de salida completada');
                })
                .catch(error => {
                    console.error('Error cargando control de salida:', error);
                    // Fallback: ejecutar inicializaci√≥n sin contenido din√°mico
                    setTimeout(() => {
                        if (typeof window.inicializarControlSalidaModule === 'function') {
                            window.inicializarControlSalidaModule();
                        }
                    }, 200);
                });
                
                console.log('üöõ === FIN mostrarControlSalida ===');
            };
            
            window.mostrarControlRetorno = function() {
                hideAllMaterialContainers();
                materialContentArea.style.display = 'block';
                controlRetornoContainer.style.display = 'block';
            };
            
            window.mostrarReciboPago = function() {
                hideAllMaterialContainers();
                materialContentArea.style.display = 'block';
                reciboPagoContainer.style.display = 'block';
            };
            
            window.mostrarHistorialMaterial = function() {
                hideAllMaterialContainers();
                materialContentArea.style.display = 'block';
                historialMaterialContainer.style.display = 'block';
            };
            
            window.mostrarEstatusMaterial = function() {
                hideAllMaterialContainers();
                materialContentArea.style.display = 'block';
                estatusMaterialContainer.style.display = 'block';
            };
            
            window.mostrarMaterialSustituto = function() {
                hideAllMaterialContainers();
                materialContentArea.style.display = 'block';
                materialSustitutoContainer.style.display = 'block';
            };
            
            window.mostrarConsultarPeps = function() {
                hideAllMaterialContainers();
                materialContentArea.style.display = 'block';
                consultarPepsContainer.style.display = 'block';
            };
            
            window.mostrarLongtermInventory = function() {
                hideAllMaterialContainers();
                materialContentArea.style.display = 'block';
                longtermInventoryContainer.style.display = 'block';
            };
            
            window.mostrarRegistroMaterial = function() {
                hideAllMaterialContainers();
                materialContentArea.style.display = 'block';
                registroMaterialContainer.style.display = 'block';
            };
            
            window.mostrarHistorialInventario = function() {
                hideAllMaterialContainers();
                materialContentArea.style.display = 'block';
                historialInventarioContainer.style.display = 'block';
            };
            
            window.mostrarAjusteNumero = function() {
                hideAllMaterialContainers();
                materialContentArea.style.display = 'block';
                ajusteNumeroContainer.style.display = 'block';
            };
            
            // Funci√≥n global para ocultar el contenido de almac√©n
            window.ocultarControlAlmacen = function() {
                materialContentArea.style.display = 'none';
                hideAllMaterialContainers();
            };
            
            navButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    // Remover la clase 'active' de todos los botones
                    navButtons.forEach(b => b.classList.remove('active'));
                    // Agregar la clase 'active' al bot√≥n clickeado
                    this.classList.add('active');
                    
                    // Ocultar todo el contenido primero
                    hideAllContent();
                    
                    if (this.id === 'Informaci√≥n Basica') {
                        console.log('Cargando pesta√±a Informaci√≥n B√°sica');
                        materialContainer.style.display = 'block';
                        informacionBasicaContent.style.display = 'block';
                        informacionBasicaContentArea.style.display = 'block';
                        
                        // Cargar contenido din√°micamente y mostrar contenedor por defecto
                        cargarContenidoDinamico('informacion-basica-content', '/listas/informacion_basica')
                            .then(() => {
                                // Asegurar que el √°rea de contenido est√© visible
                                informacionBasicaContentArea.style.display = 'block';
                                hideAllInformacionBasicaContainers();
                                const defaultContainer = document.getElementById('info-basica-default-container');
                                if (defaultContainer) {
                                    defaultContainer.style.display = 'block';
                                    console.log('‚úÖ Contenedor por defecto mostrado');
                                } else {
                                    console.error('‚ùå Contenedor por defecto no encontrado');
                                }
                                console.log('Informaci√≥n B√°sica cargada correctamente');
                            })
                            .catch(error => {
                                console.error('Error cargando Informaci√≥n B√°sica:', error);
                                // Fallback: mostrar contenedor por defecto aunque falle la carga
                                informacionBasicaContentArea.style.display = 'block';
                                hideAllInformacionBasicaContainers();
                                const defaultContainer = document.getElementById('info-basica-default-container');
                                if (defaultContainer) {
                                    defaultContainer.style.display = 'block';
                                }
                            });
                        
                    } else if (this.id === 'Control de material') {
                        console.log('Cargando pesta√±a Control de Material');
                        materialContainer.style.display = 'block';
                        controlMaterialContent.style.display = 'block';
                        
                        // Cargar contenido din√°micamente y mostrar el √°rea de material
                        cargarContenidoDinamico('control-material-content', '/listas/control_material')
                            .then(() => {
                                mostrarInfoMaterial();
                                console.log('Control de Material cargado con informaci√≥n por defecto');
                            })
                            .catch(error => {
                                console.error('Error cargando Control de Material:', error);
                                // Fallback: mostrar √°rea sin contenido din√°mico
                                mostrarInfoMaterial();
                            });
                        
                    } else if (this.id === 'Control de producci√≥n') {
                        materialContainer.style.display = 'block';
                        controlProduccionContent.style.display = 'block';
                        materialContentArea.style.display = 'none';
                        
                        // Cargar contenido din√°micamente
                        cargarContenidoDinamico('control-produccion-content', '/listas/control_produccion')
                            .catch(error => console.error('Error cargando Control de Producci√≥n:', error));
                        
                    } else if (this.id === 'Control de proceso') {
                        materialContainer.style.display = 'block';
                        controlProcesoContent.style.display = 'block';
                        materialContentArea.style.display = 'none';
                        
                        // Cargar contenido din√°micamente
                        cargarContenidoDinamico('control-proceso-content', '/listas/control_proceso')
                            .catch(error => console.error('Error cargando Control de Proceso:', error));
                        
                    } else if (this.id === 'Control de calidad') {
                        materialContainer.style.display = 'block';
                        controlCalidadContent.style.display = 'block';
                        materialContentArea.style.display = 'none';
                        
                        // Cargar contenido din√°micamente
                        cargarContenidoDinamico('control-calidad-content', '/listas/control_calidad')
                            .catch(error => console.error('Error cargando Control de Calidad:', error));
                        
                    } else if (this.id === 'Control de resultados') {
                        materialContainer.style.display = 'block';
                        controlResultadosContent.style.display = 'block';
                        materialContentArea.style.display = 'none';
                        
                        // Cargar contenido din√°micamente
                        cargarContenidoDinamico('control-resultados-content', '/listas/control_resultados')
                            .catch(error => console.error('Error cargando Control de Resultados:', error));
                        
                    } else if (this.id === 'Control de reporte') {
                        materialContainer.style.display = 'block';
                        if (controlReporteContent) controlReporteContent.style.display = 'block';
                        materialContentArea.style.display = 'none';
                        
                        // Cargar contenido din√°micamente
                        cargarContenidoDinamico('control-reporte-content', '/listas/control_reporte')
                            .catch(error => console.error('Error cargando Control de Reporte:', error));
                        
                    } else if (this.id === 'Configuraci√≥n de programa') {
                        materialContainer.style.display = 'block';
                        configuracionProgramaContent.style.display = 'block';
                        materialContentArea.style.display = 'none';
                        
                        // Cargar contenido din√°micamente
                        cargarContenidoDinamico('configuracion-programa-content', '/listas/configuracion_programa')
                            .catch(error => console.error('Error cargando Configuraci√≥n de Programa:', error));
                        
                    } else {
                        materialContainer.style.display = 'none';
                        // FORZAR ocultar el √°rea de material para cualquier otro caso
                        materialContentArea.style.display = 'none';
                    }
                });
            });
            
            // Por defecto oculto
            materialContainer.style.display = 'none';
            
            // FORZAR estado inicial correcto
            materialContentArea.style.display = 'none';
            hideAllMaterialContainers();
            
            // Activar por defecto la primera pesta√±a (Informaci√≥n B√°sica) si no hay ninguna activa
            const activeButton = document.querySelector('.nav-button.active');
            if (!activeButton) {
                const infoBasicaButton = document.getElementById('Informaci√≥n Basica');
                if (infoBasicaButton) {
                    console.log('Activando pesta√±a por defecto: Informaci√≥n B√°sica');
                    infoBasicaButton.click();
                }
            }
            
            console.log('Sistema de navegaci√≥n inicializado correctamente');
            
            // Funci√≥n gen√©rica para cargar contenido din√°micamente
            window.cargarContenidoDinamico = function(containerId, templatePath, initCallback = null) {
                console.log(`=== CARGANDO CONTENIDO DIN√ÅMICO: ${containerId} ===`);
                
                const container = document.getElementById(containerId);
                if (!container) {
                    console.error(`‚úó Container ${containerId} no encontrado`);
                    return Promise.reject(`Container ${containerId} no encontrado`);
                }
                
                // Verificar si ya tiene contenido cargado
                const placeholder = '<!-- El contenido se cargar√° din√°micamente con JavaScript -->';
                if (container.innerHTML.trim() === placeholder) {
                    console.log('Cargando contenido din√°micamente...');
                    
                    // Mostrar indicador de carga
                    container.innerHTML = '<div class="loading-indicator">Cargando...</div>';
                    
                    // Cargar el contenido din√°micamente
                    return fetch(templatePath)
                        .then(response => {
                            if (!response.ok) {
                                throw new Error('Error al cargar el contenido: ' + response.status);
                            }
                            return response.text();
                        })
                        .then(html => {
                            container.innerHTML = html;
                            console.log(`‚úÖ Contenido cargado din√°micamente en ${containerId}`);
                            
                            // Ejecutar cualquier script que pueda estar en el HTML cargado
                            const scripts = container.querySelectorAll('script');
                            scripts.forEach(script => {
                                const newScript = document.createElement('script');
                                if (script.src) {
                                    newScript.src = script.src;
                                } else {
                                    newScript.textContent = script.textContent;
                                }
                                document.head.appendChild(newScript);
                            });
                            
                            // Ejecutar callback de inicializaci√≥n si se proporciona
                            if (initCallback && typeof initCallback === 'function') {
                                setTimeout(() => {
                                    console.log(`üîÑ Ejecutando callback de inicializaci√≥n para ${containerId}`);
                                    initCallback();
                                }, 100);
                            }
                            
                            return html;
                        })
                        .catch(error => {
                            console.error('Error al cargar el contenido:', error);
                            container.innerHTML = '<div class="error-message">Error al cargar el contenido. Por favor, intente nuevamente.</div>';
                            throw error;
                        });
                } else {
                    console.log(`‚úÖ Contenido ya cargado en ${containerId}`);
                    
                    // Ejecutar callback de inicializaci√≥n si se proporciona
                    if (initCallback && typeof initCallback === 'function') {
                        setTimeout(() => {
                            console.log(`üîÑ Ejecutando callback de inicializaci√≥n para ${containerId} (contenido ya cargado)`);
                            initCallback();
                        }, 50);
                    }
                    
                    return Promise.resolve(container.innerHTML);
                }
            };
            
            // ============================================= 
            // FUNCIONES DE OPTIMIZACI√ìN M√ìVIL
            // ============================================= 
            
            // Funci√≥n para optimizar contenido para m√≥vil
            function optimizarContenidoParaMovil(container) {
                console.log('üîß Optimizando contenido para m√≥vil...');
                
                // Hacer tablas responsivas
                const tables = container.querySelectorAll('table');
                tables.forEach(table => {
                    if (!table.parentElement.classList.contains('table-responsive')) {
                        const wrapper = document.createElement('div');
                        wrapper.className = 'table-responsive';
                        table.parentNode.insertBefore(wrapper, table);
                        wrapper.appendChild(table);
                    }
                });
                
                // Optimizar formularios
                const inputs = container.querySelectorAll('input, select, textarea');
                inputs.forEach(input => {
                    if (!input.classList.contains('form-control')) {
                        input.classList.add('form-control');
                    }
                    // Prevenir zoom en iOS
                    if (input.type !== 'file' && parseFloat(getComputedStyle(input).fontSize) < 16) {
                        input.style.fontSize = '16px';
                    }
                });
                
                // Optimizar botones
                const buttons = container.querySelectorAll('button:not(.hamburger-btn)');
                buttons.forEach(button => {
                    if (!button.classList.contains('btn')) {
                        button.classList.add('btn', 'btn-primary');
                    }
                    button.style.minHeight = '44px'; // Touch target size
                });
                
                // Hacer enlaces touch-friendly
                const links = container.querySelectorAll('a');
                links.forEach(link => {
                    link.style.minHeight = '44px';
                    link.style.display = 'inline-flex';
                    link.style.alignItems = 'center';
                    link.style.padding = '8px';
                });
                
                // Optimizar im√°genes
                const images = container.querySelectorAll('img');
                images.forEach(img => {
                    img.style.maxWidth = '100%';
                    img.style.height = 'auto';
                });
                
                // A√±adir smooth scrolling
                container.style.webkitOverflowScrolling = 'touch';
                
                console.log('‚úÖ Optimizaci√≥n m√≥vil completada');
            }
            
            // Hacer la funci√≥n disponible globalmente
            window.optimizarContenidoParaMovil = optimizarContenidoParaMovil;
            
            // Funci√≥n para detectar si es dispositivo m√≥vil
            window.isMobileDevice = function() {
                return window.innerWidth <= 768 || 
                       /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            };
            
            // Aplicar optimizaciones al cargar contenido
            const originalCargarContenidoDinamico = window.cargarContenidoDinamico;
            window.cargarContenidoDinamico = function(containerId, templatePath, initCallback = null) {
                return originalCargarContenidoDinamico(containerId, templatePath, function() {
                    // Ejecutar callback original si existe
                    if (initCallback && typeof initCallback === 'function') {
                        initCallback();
                    }
                    
                    // Aplicar optimizaciones m√≥viles
                    if (window.isMobileDevice()) {
                        const container = document.getElementById(containerId);
                        if (container) {
                            optimizarContenidoParaMovil(container);
                        }
                    }
                });
            };
            
            // Funci√≥n global para mostrar Control de Material en Informaci√≥n B√°sica
            window.mostrarControlMaterialInfoGlobal = function() {
                console.log('=== INICIANDO mostrarControlMaterialInfoGlobal (INFORMACI√ìN B√ÅSICA) ===');
                console.log('üè∑Ô∏è Esta es la funci√≥n global del MaterialTemplate');
                
                // Primero asegurar que estamos en la pesta√±a correcta
                const infoBasicaButton = document.getElementById('Informaci√≥n Basica');
                if (infoBasicaButton && !infoBasicaButton.classList.contains('active')) {
                    console.log('‚ö†Ô∏è Cambiando a pesta√±a Informaci√≥n B√°sica primero...');
                    infoBasicaButton.click();
                    // Esperar un poco a que se cargue
                    setTimeout(() => {
                        window.mostrarControlMaterialInfo();
                    }, 500);
                    return;
                }
                
                // Asegurarse de que estemos en el √°rea correcta
                const informacionBasicaArea = document.getElementById('informacion-basica-content-area');
                if (informacionBasicaArea) {
                    informacionBasicaArea.style.display = 'block';
                    console.log('‚úÖ √Årea de contenido de Informaci√≥n B√°sica activada');
                } else {
                    console.error('‚ùå informacion-basica-content-area no encontrado');
                    return;
                }
                
                // Ocultar todos los contenedores de Informaci√≥n B√°sica
                if (typeof hideAllInformacionBasicaContainers === 'function') {
                    hideAllInformacionBasicaContainers();
                    console.log('‚úÖ Todos los contenedores de Informaci√≥n B√°sica ocultados');
                } else {
                    console.error('‚ùå hideAllInformacionBasicaContainers no disponible');
                }
                
                // Obtener el contenedor espec√≠fico
                const container = document.getElementById('control-material-info-container');
                if (container) {
                    // Mostrar el contenedor primero
                    container.style.display = 'block';
                    container.style.visibility = 'visible';
                    container.style.opacity = '1';
                    
                    console.log('üìã Container control-material-info-container encontrado y mostrado');
                    
                    // Cargar contenido din√°micamente
                    cargarContenidoDinamico('control-material-info-container', '/informacion_basica/control_de_material')
                        .then(() => {
                            console.log('‚úÖ Contenido CONTROL_DE_MATERIAL.html cargado exitosamente en Informaci√≥n B√°sica');
                            console.log('üìç Ubicaci√≥n: Informaci√≥n B√°sica ‚Üí Control de material ‚Üí Control de material');
                            console.log('Display:', window.getComputedStyle(container).display);
                            console.log('Visibility:', window.getComputedStyle(container).visibility);
                            console.log('Opacity:', window.getComputedStyle(container).opacity);
                        })
                        .catch(error => {
                            console.error('‚ùå Error en mostrarControlMaterialInfo:', error);
                            container.innerHTML = '<div style="color: red; padding: 20px;">Error al cargar el contenido. Por favor, intente nuevamente.</div>';
                        });
                } else {
                    console.error('‚ùå Container control-material-info-container no encontrado');
                    // Debug: listar todos los contenedores disponibles
                    const allContainers = document.querySelectorAll('[id*="container"]');
                    console.log('üîç Contenedores disponibles:', Array.from(allContainers).map(c => c.id));
                }
                
                console.log('=== FIN mostrarControlMaterialInfoGlobal ===');
            };
            
            // Marcar la funci√≥n como global
            window.mostrarControlMaterialInfoGlobal._isGlobal = true;
            
            // Tambi√©n mantener la funci√≥n original como alias para compatibilidad
            window.mostrarControlMaterialInfo = window.mostrarControlMaterialInfoGlobal;
            window.mostrarControlMaterialInfo._isGlobal = true;
        });


        
    </script>
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const controlAlmacenContainer = document.getElementById('control-almacen-container');
        if (controlAlmacenContainer) {
            console.log('üîÑ Inicializando m√≥dulo Control de Almac√©n desde MaterialTemplate...');
            window.inicializarControlAlmacenModule();
        } else {
            console.warn('‚ö†Ô∏è Contenedor de Control de Almac√©n no encontrado en MaterialTemplate.');
        }
    });
</script>
</div>
</body>
</html>