<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Modal Eliminar</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-button { padding: 10px 20px; margin: 10px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        .test-button:hover { background: #0056b3; }
        .log { background: #f8f9fa; padding: 15px; margin: 15px 0; border: 1px solid #ddd; border-radius: 4px; max-height: 300px; overflow-y: auto; }
    </style>
</head>
<body>
    <h1>üß™ Test Modal de Eliminaci√≥n</h1>
    
    <div>
        <button class="test-button" onclick="testModal()">Probar Modal de Edici√≥n</button>
        <button class="test-button" onclick="checkModalHTML()">Verificar HTML del Modal</button>
        <button class="test-button" onclick="clearLog()">Limpiar Log</button>
    </div>
    
    <div id="log" class="log">
        <strong>üìã Log de pruebas:</strong><br>
    </div>

    <script>
        function log(message) {
            const logDiv = document.getElementById('log');
            logDiv.innerHTML += new Date().toLocaleTimeString() + ' - ' + message + '<br>';
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function clearLog() {
            document.getElementById('log').innerHTML = '<strong>üìã Log de pruebas:</strong><br>';
        }

        function testModal() {
            log('üîç Iniciando prueba de modal...');
            
            // Simular datos de prueba con ID
            const testData = {
                id: 123,
                modelo: 'EBR23966202',
                Job: 'Test Job',
                linea: 'D3',
                Usuario: 'Yahir'
            };
            
            log('üìä Datos de prueba: ' + JSON.stringify(testData));
            
            // Verificar si el modal existe
            if (window.rawEditModal) {
                log('‚úÖ Modal encontrado, abriendo con datos de prueba...');
                window.rawEditModal.abrir(testData, 'EDITAR');
                
                // Verificar bot√≥n eliminar despu√©s de un momento
                setTimeout(() => {
                    const btnEliminar = document.getElementById('btn-eliminar');
                    if (btnEliminar) {
                        log('‚úÖ Bot√≥n eliminar encontrado: ' + btnEliminar.style.display);
                        log('üÜî Record ID en bot√≥n: ' + btnEliminar.getAttribute('data-record-id'));
                    } else {
                        log('‚ùå Bot√≥n eliminar NO encontrado');
                    }
                }, 100);
                
            } else {
                log('‚ùå Modal NO encontrado, creando nuevo...');
                try {
                    window.rawEditModal = new RawEditModal();
                    log('‚úÖ Modal creado exitosamente');
                    window.rawEditModal.abrir(testData, 'EDITAR');
                } catch (error) {
                    log('‚ùå Error creando modal: ' + error.message);
                }
            }
        }

        function checkModalHTML() {
            log('üîç Verificando HTML del modal...');
            
            const modal = document.getElementById('rawEditModal');
            if (modal) {
                log('‚úÖ Modal HTML encontrado');
                
                const btnEliminar = document.getElementById('btn-eliminar');
                if (btnEliminar) {
                    log('‚úÖ Bot√≥n eliminar encontrado en DOM');
                    log('üé® Estilo display: ' + btnEliminar.style.display);
                    log('üìù Contenido: ' + btnEliminar.innerHTML);
                } else {
                    log('‚ùå Bot√≥n eliminar NO encontrado en DOM');
                }
                
                const footer = modal.querySelector('.modal-footer');
                if (footer) {
                    log('‚úÖ Footer encontrado');
                    log('üìù Footer HTML: ' + footer.innerHTML.substring(0, 200) + '...');
                } else {
                    log('‚ùå Footer NO encontrado');
                }
                
            } else {
                log('‚ùå Modal HTML NO encontrado');
            }
        }

        // Cargar el script del visor MySQL
        document.addEventListener('DOMContentLoaded', function() {
            log('üöÄ P√°gina cargada, inicializando...');
            
            // Simular las variables globales necesarias
            window.RX = {
                table: "raw",
                columns: ["id", "modelo", "Job", "linea", "Usuario"],
                rows: [],
                allRows: []
            };
            
            // Crear funci√≥n $ si no existe
            if (!window.$) {
                window.$ = (id) => document.getElementById(id);
            }
            
            log('‚úÖ Variables globales inicializadas');
            log('‚è≥ Esperando a que se cree el modal...');
        });
    </script>
    
    <!-- Cargar el script del visor MySQL -->
    <script src="/static/js/visor_mysql.js"></script>
</body>
</html>
